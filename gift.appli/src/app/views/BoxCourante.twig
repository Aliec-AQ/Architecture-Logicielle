{% extends 'index.twig' %}
{% block content %}
<div class="box-container">
    <section class="box-info">
        <div class="displayCard">
            <h2 class="info-title">{{box.libelle}}</h2>
            <div>
                <h3>Description de la box : </h3>
                <p class="info-description">{{ box.description }}</p>
            </div>
            {% if  box.kdo %}
            <div class="gift">
                <h2 class="gift-title">- Cadeau -</h2>
                <p class="gift-message">{{ box.message_kdo }}</p>
            </div>
            {% endif %}

            {% if box.statut == 1 %}
            <form method="post" action="{{ url_for('validateBox', {'id': box.id}) }}">
                <input type="hidden" name="_csrf_token" value="{{ csrf_token }}" />
                <button class="bouton" type="submit">Valider la box</button>
            </form>
            <a class="bouton" href="{{ url_for('listePrestations') }}">Voir les prestations</a>
            {% endif %}
            {% if box.statut == 2 %}
            <form method="post" action="{{ url_for('payBox', {'id': box.id}) }}">
                <input type="hidden" name="_csrf_token" value="{{ csrf_token }}" />
                <button class="bouton" type="submit">Payer la box</button>
            </form>
            {% endif %}
        </div>
    </section>
    <section class="box-prestations">
        <table class="prestations-table">
            <thead>
                <tr class="prestation-row">
                    <th>Prestation</th>
                    <th>Quantité</th>
                    <th>Prix unitaire</th>
                    <th>Prix</th>
                </tr>
            </thead>
            <tbody>
                {% for prestation in box.prestations %}
                <tr class="prestation-row">
                    <td>
                    <div class="splinter_cell">
                        {% if box.statut <= 1 %}
                        <form method="post" action="{{ url_for('removePrestationToBox', {'id': prestation.id}) }}">
                            <input type="hidden" name="box_id" value="{{ box.id }}">
                            <input type="hidden" name="_csrf_token" value="{{ csrf_token }}" />
                            <button class="button-box" type="submit">X</button>
                        </form>
                        {% endif %}
                        
                        <p>
                            {{ prestation.libelle }}
                        </p>
                        </div>
                    </td>
                    <td>
                        <div class="splinter_cell">
                            {% if box.statut <= 1 %}
                            <form method="post" action="{{ url_for('updateQuantiteToBox', {'id': prestation.id}) }}">
                                <input type="hidden" name="box_id" value="{{ box.id }}">
                                <input type="hidden" name="_csrf_token" value="{{ csrf_token }}" />
                                <input type="number" name="quantite" value="{{ prestation.pivot.quantite }}" min="0">
                                <button class="button-box" type="submit">&#10227;</button>
                            </form>
                            {% else %}
                                {{ prestation.pivot.quantite }}
                            {% endif %}
                        </div>
                    </td>
                    </td>
                    <td>{{ prestation.tarif }} €</td>
                    <td>{{ prestation.tarif * prestation.pivot.quantite  }} €</td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr class="prestation-row">
                    <td><h3>Montant total</h3></td>
                    <td></td>
                    <td></td>
                    <td>{{ box.montant }} €</td>
                </tr>
            </tfoot>
        </table>
    </section>
</div>
{% endblock %}